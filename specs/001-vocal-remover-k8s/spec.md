# 功能規格：人聲去除服務

**功能分支**: `001-vocal-remover-k8s`
**建立日期**: 2025-11-27
**狀態**: 草稿
**輸入**: 使用者描述：「我想要做一個可以提供 Youtube 網址或自行上傳影片，然後自行去人聲，把剩下的伴奏合到原本的影片，讓使用者可以下載。把這個做成 K8s 服務」

## 使用者情境與測試 *(必填)*

### 使用者故事 1 - 透過 YouTube 網址製作伴奏影片 (優先級: P1)

使用者想要將 YouTube 上的 MV 或音樂影片轉換成卡拉 OK 伴奏版本。使用者在網頁上輸入 YouTube 影片網址，系統自動下載影片、分離人聲與伴奏、將伴奏音軌合併回原始影片，最後提供下載連結。

**為什麼是這個優先級**: 這是核心功能，大多數使用者會透過 YouTube 網址來使用服務，無需事先準備檔案。

**獨立測試**: 可透過輸入一個有效的 YouTube 音樂影片網址，驗證能否成功產生並下載去人聲的伴奏影片。

**驗收情境**:

1. **Given** 使用者在首頁，**When** 輸入有效的 YouTube 影片網址並點擊「處理」，**Then** 系統開始處理並顯示進度。
2. **Given** 處理完成，**When** 使用者查看結果頁面，**Then** 可以預覽處理後的影片並看到下載按鈕。
3. **Given** 處理後的影片已產生，**When** 使用者點擊下載，**Then** 影片檔案成功下載到本地。

---

### 使用者故事 2 - 上傳本地影片製作伴奏影片 (優先級: P2)

使用者有本地的影片檔案（例如：手機錄製的演唱影片），想要去除人聲保留背景音樂。使用者上傳影片檔案，系統處理後提供下載。

**為什麼是這個優先級**: 補充 YouTube 網址功能，讓沒有 YouTube 來源的影片也能處理。

**獨立測試**: 可透過上傳一個含有人聲的本地影片檔案，驗證能否成功產生並下載去人聲的伴奏影片。

**驗收情境**:

1. **Given** 使用者在上傳頁面，**When** 選擇並上傳有效的影片檔案，**Then** 系統開始上傳並顯示上傳進度。
2. **Given** 上傳完成，**When** 使用者確認處理，**Then** 系統開始分離人聲並顯示處理進度。
3. **Given** 處理完成，**When** 使用者查看結果，**Then** 可以下載去人聲後的影片。

---

### 使用者故事 3 - 查看處理進度與狀態 (優先級: P3)

使用者提交影片後想要知道目前的處理進度。系統提供即時的狀態更新，讓使用者了解還需等待多久。

**為什麼是這個優先級**: 改善使用者體驗，但不影響核心功能運作。

**獨立測試**: 可透過提交一個處理任務，驗證進度條與狀態訊息是否正確反映實際處理階段。

**驗收情境**:

1. **Given** 使用者已提交處理任務，**When** 處理正在進行中，**Then** 頁面顯示目前處理階段（下載中/分離中/合併中）與預估剩餘時間。
2. **Given** 使用者關閉瀏覽器後重新開啟，**When** 透過任務連結訪問，**Then** 仍可查看該任務的最新狀態。

---

### 邊界情況

- YouTube 網址無效或影片不存在時，系統顯示明確的錯誤訊息
- YouTube 影片受版權保護無法下載時，系統告知使用者無法處理
- 上傳的影片格式不支援時，系統提示支援的格式清單
- 影片檔案過大超過限制時，系統告知大小限制
- 影片沒有音軌時，系統告知無法處理
- 處理過程中服務異常時，系統保留任務狀態供重試
- 多個使用者同時提交時，系統依序處理並正確回報各自的進度

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系統 MUST 接受有效的 YouTube 影片網址作為輸入
- **FR-002**: 系統 MUST 接受使用者上傳的影片檔案（支援 MP4、MOV、AVI、MKV 格式）
- **FR-003**: 系統 MUST 限制上傳檔案大小不超過 500MB
- **FR-004**: 系統 MUST 限制影片長度不超過 10 分鐘
- **FR-005**: 系統 MUST 從影片音軌中分離出人聲與伴奏
- **FR-006**: 系統 MUST 將伴奏音軌重新合併到原始影片（保留原始畫面）
- **FR-007**: 系統 MUST 提供處理後影片的下載功能
- **FR-008**: 系統 MUST 顯示處理進度與預估剩餘時間
- **FR-009**: 系統 MUST 產生唯一的任務識別碼供使用者追蹤
- **FR-010**: 系統 MUST 在處理失敗時提供明確的錯誤訊息
- **FR-011**: 系統 MUST 支援 Kubernetes 環境部署與水平擴展
- **FR-012**: 系統 MUST 保留處理結果 24 小時，過期後自動刪除

### 關鍵實體

- **任務 (Job)**: 代表一次影片處理請求，包含來源（URL 或上傳檔案）、狀態、進度、建立時間、完成時間
- **處理結果 (Result)**: 代表處理完成的輸出，包含原始影片資訊、處理後影片、下載連結、過期時間

## 成功標準 *(必填)*

### 可衡量成果

- **SC-001**: 使用者從輸入網址到開始下載的整體流程可在 5 分鐘內完成（對於 3 分鐘以內的標準音樂影片）
- **SC-002**: 人聲分離品質達到 90% 以上的人聲移除效果（背景音樂保持清晰）
- **SC-003**: 服務可同時處理至少 10 個並行任務
- **SC-004**: 服務可用性達到 99% 以上
- **SC-005**: 80% 的使用者能在無說明的情況下成功完成首次操作

## 假設

- 使用者有穩定的網路連線可以上傳影片和下載結果
- YouTube 影片的下載功能在法律允許的範圍內使用（個人用途）
- 大多數使用情境為處理音樂類影片（有清晰的人聲與伴奏分離）
- 使用者不需要註冊帳號即可使用服務（匿名存取）
- 處理結果為暫存性質，不提供永久儲存
