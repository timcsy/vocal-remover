# 技術研究：人聲去除服務

**日期**: 2025-11-27
**功能**: 001-vocal-remover-k8s

## 人聲分離技術

### 決策：使用 Demucs（Meta）

**理由**：
- 分離品質 92-95%，穩定超過 90% 需求
- Meta 官方維護，持續更新
- 支援 GPU 加速，3 分鐘音樂可在 30-60 秒內處理
- 原生 Python API，易於容器化和 K8s 部署

**替代方案**：
- Spleeter：速度快但品質僅 85-88%，無法達到 90% 需求
- UVR：品質好但文檔少、配置複雜

### 硬體需求

| 配置 | 3 分鐘音樂處理時間 |
|------|-------------------|
| NVIDIA T4 16GB | 120-180 秒 |
| NVIDIA A100 40GB | 30-45 秒 |
| CPU only（不推薦） | 5-20 分鐘 |

## 後端框架

### 決策：FastAPI

**理由**：
- 原生 ASGI 異步支援，適合高並發任務
- 自動產生 Swagger API 文檔
- 原生 WebSocket 支援進度追蹤
- Pydantic 自動資料驗證

**替代方案**：
- Flask：需額外配置異步，文檔需手動整合

## 前端框架

### 決策：Vue 3 + Vite

**理由**：
- 輕量化（50-100KB）
- 學習曲線平緩
- 快速開發伺服器
- 符合簡潔設計原則

**替代方案**：
- React：包較大（120-150KB），學習曲線陡峭
- 純 HTML + HTMX：更簡單但互動性受限

## 任務佇列

### 決策：RQ（Redis Queue）

**理由**：
- 簡潔，符合專案規模
- 與 FastAPI 整合簡單
- 支援 KEDA 自動擴展
- 任務持久化在 Redis

**替代方案**：
- Celery：功能過多，配置複雜
- Dramatiq：效能好但學習成本較高

## 檔案儲存

### 決策：MinIO

**理由**：
- S3 相容 API，未來可遷移至 AWS
- K8s 原生部署
- 內建生命週期規則（24 小時自動刪除）
- 簡單 Helm chart 部署

**替代方案**：
- 本地 PV：難以水平擴展
- AWS S3：外部依賴、增加複雜度

## 技術棧總結

| 層級 | 技術選擇 |
|------|---------|
| 人聲分離 | Demucs 4.0 |
| 後端 | FastAPI + Uvicorn |
| 前端 | Vue 3 + Vite |
| 任務佇列 | RQ + Redis |
| 檔案儲存 | MinIO |
| 影片下載 | yt-dlp |
| 影片處理 | FFmpeg + moviepy |
| 容器 | Docker |
| 編排 | Kubernetes + KEDA |
