# Feature Specification: Video Mixer 影片混音器

**Feature Branch**: `004-video-mixer`
**Created**: 2025-01-28
**Status**: Draft
**Input**: User description: "將人聲去除服務重構為影片混音器，新增左側抽屜顯示已完成歌曲、ZIP 匯出匯入功能、模態視窗新增歌曲、底部任務佇列"

## Clarifications

### Session 2025-01-28

- Q: 應用啟動時，左側抽屜是預設開啟還是收合？ → A: 預設開啟（桌面版顯示，手機版收合）
- Q: 系統是否同時處理多個任務，還是一次只處理一個？ → A: 單一任務處理（一次只處理一個，其餘排隊等待）
- Q: 當匯入的歌曲名稱與已存在的歌曲相同時，系統應如何處理？ → A: 詢問使用者（彈出確認視窗讓使用者選擇覆蓋或重新命名）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 管理已完成歌曲 (Priority: P1)

使用者可以在左側抽屜中查看所有已完成處理的歌曲列表，點擊任一歌曲即可在主頁面查看並操作該歌曲的混音控制。

**Why this priority**: 這是整個應用的核心導覽功能，沒有歌曲列表就無法有效管理多首歌曲。

**Independent Test**: 可以透過處理一首歌曲後，在左側抽屜中看到該歌曲並點擊切換來測試，驗證使用者能有效管理多首歌曲。

**Acceptance Scenarios**:

1. **Given** 有多首已完成處理的歌曲，**When** 使用者開啟左側抽屜，**Then** 看到所有歌曲列表並顯示歌曲名稱
2. **Given** 左側抽屜已開啟，**When** 使用者點擊某首歌曲，**Then** 主頁面顯示該歌曲的混音控制介面
3. **Given** 左側抽屜已開啟，**When** 使用者勾選多首歌曲的 checkbox，**Then** 可以進行批次操作（匯出、刪除）

---

### User Story 2 - 新增歌曲處理 (Priority: P1)

使用者可以透過主頁面的「新增歌曲」按鈕開啟模態視窗，選擇貼上 YouTube URL 或上傳本地影片，提交後任務加入處理佇列。

**Why this priority**: 新增歌曲是應用的入口功能，與管理歌曲同等重要。

**Independent Test**: 可以透過點擊新增按鈕、輸入 YouTube URL、提交後看到任務進入佇列來測試。

**Acceptance Scenarios**:

1. **Given** 主頁面，**When** 使用者點擊「新增歌曲」按鈕，**Then** 彈出模態視窗提供輸入選項
2. **Given** 模態視窗已開啟，**When** 使用者貼上有效的 YouTube URL 並提交，**Then** 任務加入佇列並顯示在底部任務列表
3. **Given** 模態視窗已開啟，**When** 使用者上傳本地影片檔案並提交，**Then** 任務加入佇列並顯示在底部任務列表
4. **Given** 模態視窗已開啟，**When** 使用者提交無效輸入，**Then** 顯示錯誤訊息並保持視窗開啟

---

### User Story 3 - 查看任務佇列進度 (Priority: P2)

使用者可以在頁面底部看到所有正在處理和等待中的任務，每個任務顯示處理進度，點擊任務可查看詳細進度資訊。

**Why this priority**: 任務進度是使用者體驗的重要部分，讓使用者知道處理狀態。

**Independent Test**: 可以透過提交一個新任務，觀察底部佇列顯示該任務及其進度更新來測試。

**Acceptance Scenarios**:

1. **Given** 有任務正在處理中，**When** 使用者查看底部任務佇列，**Then** 看到任務名稱、狀態和進度百分比
2. **Given** 任務佇列有多個任務，**When** 使用者點擊某個任務，**Then** 彈出詳細進度視窗顯示更多資訊
3. **Given** 任務完成處理，**When** 處理結束，**Then** 任務從佇列移除並出現在左側抽屜的歌曲列表中

---

### User Story 4 - 匯出歌曲 (Priority: P2)

使用者可以選取一首或多首歌曲，匯出為 ZIP 壓縮檔，內含四軌 WAV 音檔和原始影片。

**Why this priority**: 匯出功能讓使用者可以備份和轉移作品，是重要的資料管理功能。

**Independent Test**: 可以透過勾選歌曲、點擊匯出、下載 ZIP 檔並驗證內容完整性來測試。

**Acceptance Scenarios**:

1. **Given** 左側抽屜有已完成歌曲，**When** 使用者勾選一首歌曲並點擊「匯出」，**Then** 下載該歌曲的 ZIP 檔（包含 4 軌 WAV + 原始影片 + metadata.json）
2. **Given** 左側抽屜有多首已完成歌曲，**When** 使用者勾選多首歌曲並點擊「匯出」，**Then** 下載包含多個歌曲 ZIP 的壓縮檔
3. **Given** 沒有勾選任何歌曲，**When** 使用者點擊「匯出」，**Then** 顯示提示訊息要求選擇歌曲

---

### User Story 5 - 匯入歌曲 (Priority: P3)

使用者可以匯入之前匯出的 ZIP 檔案，還原歌曲到應用中，無需重新處理。

**Why this priority**: 匯入功能是匯出的配對功能，允許使用者在不同裝置或時間恢復作品。

**Independent Test**: 可以透過選擇一個有效的 ZIP 檔、匯入後看到歌曲出現在左側抽屜來測試。

**Acceptance Scenarios**:

1. **Given** 主頁面或左側抽屜，**When** 使用者點擊「匯入」並選擇有效的 ZIP 檔，**Then** 歌曲還原並出現在左側抽屜
2. **Given** 使用者選擇包含多首歌曲的 ZIP，**When** 匯入完成，**Then** 所有歌曲出現在左側抽屜
3. **Given** 使用者選擇無效或損壞的 ZIP 檔，**When** 嘗試匯入，**Then** 顯示錯誤訊息說明問題

---

### Edge Cases

- 當匯入的 ZIP 檔案格式不正確或缺少必要檔案時，系統應顯示明確的錯誤訊息
- 當一次匯入大量歌曲時（超過 10 首），系統應限制數量並提示使用者
- 當任務佇列滿載時，新任務應排隊等待，不應拒絕使用者請求
- 當使用者嘗試刪除正在處理中的任務時，應先確認後再取消處理
- 當網路不穩定導致 YouTube 下載失敗時，應提供重試選項

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統 MUST 提供左側抽屜顯示所有已完成處理的歌曲列表，桌面版預設開啟，手機版預設收合
- **FR-002**: 系統 MUST 允許使用者透過點擊歌曲切換主頁面顯示的內容
- **FR-003**: 系統 MUST 在歌曲列表項目提供 checkbox 支援多選功能
- **FR-004**: 系統 MUST 提供「新增歌曲」模態視窗，支援 YouTube URL 輸入和本地檔案上傳
- **FR-005**: 系統 MUST 在頁面底部顯示任務佇列，包含處理中和等待中的任務
- **FR-006**: 系統 MUST 即時更新任務處理進度（每 2 秒輪詢一次）
- **FR-016**: 系統 MUST 一次只處理一個任務，其餘任務排隊等待
- **FR-007**: 系統 MUST 提供匯出功能，將選定歌曲打包為 ZIP 檔案
- **FR-008**: 系統 MUST 在匯出的 ZIP 中包含四軌 WAV 音檔（drums、bass、other、vocals）、原始影片和 metadata.json
- **FR-009**: 系統 MUST 提供匯入功能，解析 ZIP 檔案並還原歌曲
- **FR-010**: 系統 MUST 驗證匯入的 ZIP 檔案格式正確性
- **FR-011**: 系統 MUST 支援單首和多首歌曲的 ZIP 格式
- **FR-017**: 系統 MUST 在匯入歌曲名稱衝突時彈出確認視窗，讓使用者選擇覆蓋或重新命名
- **FR-012**: 系統 MUST 允許使用者刪除已完成的歌曲
- **FR-013**: 系統 MUST 在任務完成後自動將歌曲加入左側抽屜列表
- **FR-014**: 系統 MUST 提供任務詳情模態視窗顯示處理進度細節
- **FR-015**: 系統 MUST 限制單次匯入不超過 10 首歌曲

### Key Entities

- **Song（歌曲）**: 代表一首已處理完成的歌曲，包含歌曲名稱、來源類型（YouTube/上傳）、來源 URL、建立時間、四軌音檔路徑、原始影片路徑
- **Task（任務）**: 代表一個處理中的任務，包含任務 ID、歌曲名稱、狀態（等待中/處理中/完成/失敗）、進度百分比
- **Export Package（匯出包）**: 代表匯出的 ZIP 結構，包含四軌 WAV、原始影片、metadata.json

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可以在 3 秒內從左側抽屜切換到任一歌曲的混音介面
- **SC-002**: 使用者可以在 1 分鐘內完成新增一首歌曲到處理佇列
- **SC-003**: 任務進度更新延遲不超過 3 秒
- **SC-004**: 單首歌曲的匯出操作在 30 秒內完成（不含下載時間）
- **SC-005**: 匯入的歌曲可以立即在混音介面中使用，無需等待處理
- **SC-006**: 左側抽屜可以顯示至少 100 首歌曲而不影響效能
- **SC-007**: 底部任務佇列可以同時顯示至少 10 個任務

## Assumptions

- 使用者瀏覽器支援現代 Web API（File API、Web Audio API）
- 歌曲資料僅保存在記憶體中，不使用資料庫持久化
- 匯出的 ZIP 檔案格式為標準 ZIP，metadata.json 使用 JSON 格式
- 任務佇列使用輪詢方式更新（每 2 秒），不使用 WebSocket
- 左側抽屜使用 CSS transform 實現滑入滑出動畫
